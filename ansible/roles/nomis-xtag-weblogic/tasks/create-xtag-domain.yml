---

- name: Create nomis xtag domain
  block:

    - name: Copy scripts and properties files 
      ansible.builtin.template:
        src: "10.3{{ item }}"
        dest: "{{ item }}"
        owner: oracle
        group: oinstall
      loop:
        - /u01/software/weblogic/WLS_XTAG_OUTBOUND_01.properties
        - /u01/software/weblogic/domain.properties
        - /u01/software/weblogic/AdminServer.properties

    - name: Create weblogic Nomis xtag domain 
      become_user: oracle
      ansible.builtin.shell: |
        set -eo pipefail
        . ~/.bash_profile
        . $WL_HOME/server/bin/setWLSEnv.sh
        main() {
          echo "# create weblogic NomisDomain"
          java weblogic.WLST ~/admin/scripts/create_managed_app.py -p /u01/software/weblogic/domain.properties
        main 2>&1 | logger -p local3.info -t ansible-weblogic
      async: 7200
      poll: 60