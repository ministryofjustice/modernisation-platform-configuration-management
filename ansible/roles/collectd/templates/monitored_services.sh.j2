# Templated in from ansible
HOSTNAME="${HOSTNAME:-localhost}"
INTERVAL="{{ collectd_script_interval }}"
MONITORED_SERVICES="{{ collectd_monitored_services | join(' ') }}"

service_status() {
    local SERVICE="$1"
    {% if ansible_distribution in ['RedHat', 'OracleLinux'] and ansible_distribution_major_version == '6' %}
    # RHEL6 service check
    service_status=$(sudo service $SERVICE status | grep "running")
    if [[ $service_status ]]
    then
        return 0
    else
        return 1
    fi
    {% else %}
    systemctl is-active --quiet $SERVICE
    {% endif %}
}

while sleep "$INTERVAL"
do
    for service in ${LINUX_SERVICE_LIST}
    do
        service_status "$service" 
        status=$?

        service_name=${service//_}
        service_name=${service_name//-}
        echo "PUTVAL $HOSTNAME/$service_name/bool interval=$INTERVAL N:$status"
    done
done

// FIXME: see whether the bool-$service_name here is even needed? Probably not but let's try it out
// FIXME: test the monitored_services.sh.j2 script can handle amazon-ssm-agent and amazon-cloudwatch-agent services on Rhel6