# Templated in from ansible
HOSTNAME="${HOSTNAME:-localhost}"
INTERVAL="{{ collectd_script_interval }}"
MONITORED_SERVICES="{{ monitored_services }}"

service_status() {
    local SERVICE="$1"
    {% if ansible_distribution in ['RedHat', 'OracleLinux'] and ansible_distribution_major_version == '6' %}
    # RHEL6 service check
    service_status=$(sudo service $SERVICE status | grep "running")
    if [[ $service_status ]]
    then
        return 0
    else
        return 1
    fi
    {% else %}
    systemctl is-active --quiet $SERVICE
    {% endif %}
}

while sleep "$INTERVAL"
do
    for service in ${LINUX_SERVICE_LIST}
    do
        service_status "$service" 
        status=$?

        service_name=${service//_}
        echo "PUTVAL $HOSTNAME/$service_name/bool-$service_name interval=$INTERVAL N:$status"
    done
done

// FIXME: see whether the bool-$service_name here is even needed?
// FIXME: amazon-ssm-agent and amazon-cloudwatch-agent services need to be added to the service list
// FIXME: casing or dashes in the service names need to be handled