---

- name: create rman backup script
  template:
    src: rman_tape_backup.cmd.j2
    dest: "{{ stage }}/rman_backup.cmd"
    owner: "oracle"
    group: "dba"
    mode: "0700"

# - name: Run rman backup script 
#   become_user: oracle
#   ansible.builtin.shell: |
#     export PATH=$PATH:/usr/local/bin
#     source oraenv <<< {{ db_name }}
#     rman target / cmdfile="{{ stage }}/rman_backup.cmd" log="{{ stage }}/{{ LABEL }}_db_backup.log"

- name: Copy password file 
  become_user: oracle
  ansible.builtin.shell: |
    . ~/.bash_profile
    export PATH=$PATH:/usr/local/bin
    source oraenv <<< {{ db_name }}
    aws s3 cp $ORACLE_HOME/dbs/orapw{{ db_name }} s3://{{ ansible_aws_ssm_bucket_name }}/