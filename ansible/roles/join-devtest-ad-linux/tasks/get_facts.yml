---
- name: Get secretsmanager passwords
  import_role:
    name: secretsmanager-passwords
  vars:
    secretsmanager_passwords: "{{ service_account_secretsmanager_passwords }}"

- name: Set secretsmanager facts
  set_fact:
    join_domain_linux_service_account_username: "{{ secretsmanager_passwords_dict['service_account'].passwords['username'] }}"
    join_domain_linux_service_account_password: "{{ secretsmanager_passwords_dict['service_account'].passwords['password'] }}"

- name: Check secrets
  set_fact:
    all_variables_set: true
  when:
    - join_domain_linux_service_account_username|length > 0
    - join_domain_linux_service_account_password|length > 0

- name: Fail if missing secrets
  fail:
    msg: Ensure all required parameters are set
  when: not all_variables_set|default(false)
