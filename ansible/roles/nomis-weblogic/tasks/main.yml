---
- name: Rhel6
  block:
    # temporarily putting this at the start so we can more easily diagnose failures
    - import_tasks: complete-autoscaling-hook.yml
      tags:
        - ec2provision
        - weblogic_complete_autoscaling_hook

    - import_tasks: get-facts.yml
      tags:
        - ec2provision
        - ec2provision1
        - ec2provision2
        - ec2provisionx
        - ec2patch
        - weblogic_moj_admin_scripts
        - weblogic_configure_forms
        - weblogic_copy_managed_server_files
        - weblogic_certificate_fix
        - weblogic_compile_tag_source
        - weblogic_create_managed_app
        - weblogic_create_additional_form_servers

    - import_tasks: packages.yml
      tags:
        - amibuild
        - weblogic_packages
        - ec2provision  # TODO: remove after testing

    - import_tasks: users.yml
      tags:
        - amibuild
        - weblogic_users
        - ec2provision  # TODO: remove after testing

    - import_tasks: disks.yml
      tags:
        - amibuild
        - weblogic_disks
        - ec2provision  # TODO: remove after testing

    - import_tasks: swap.yml
      tags:
        - amibuild
        - weblogic_swap
        - ec2provision  # TODO: remove after testing

    - import_tasks: install-jdk.yml
      tags:
        - amibuild
        - weblogic_install_jdk
        - ec2provision  # TODO: remove after testing

    - import_tasks: sysctl-update.yml
      tags:
        - amibuild
        - weblogic_sysctl_update
        - ec2provision  # TODO: remove after testing

    - import_tasks: oracle-limits-update.yml
      tags:
        - amibuild
        - weblogic_oracle_limits_update
        - ec2provision  # TODO: remove after testing

    - import_tasks: install-server.yml
      tags:
        - amibuild
        - weblogic_install_server
        - ec2provision  # TODO: remove after testing

    - import_tasks: install-forms.yml
      tags:
        - amibuild
        - weblogic_install_forms

    - import_tasks: moj-admin-scripts.yml
      tags:
        - ec2provision1
        - weblogic_moj_admin_scripts

    - import_tasks: configure-forms.yml
      tags:
        - ec2provisionx
        - weblogic_configure_forms
        
    - import_tasks: copy-managed-server-files.yml
      tags:
        - ec2provision1
        - weblogic_copy_managed_server_files

    - import_tasks: patch-forms.yml
      vars:
        forms_patch_filename: /u01/software/forms_patch/9473270.tgz
        forms_patch_id: 9473270
      tags:
        - ec2provision1
        - amibuild
        - weblogic_patch_forms

    - import_tasks: make-forms.yml
      tags:
        - ec2provision1
        - weblogic_make_forms

    - import_tasks: compile-tag-source.yml
      tags:
        - ec2provision1
        - weblogic_compile_tag_source

    - include_tasks:
        file: create-managed-app.yml
        apply:
          tags:
            - ec2provisionx
            - weblogic_create_managed_app
      tags:
        - ec2provisionx
        - weblogic_create_managed_app
      loop_control:
        loop_var: weblogic_managed_app
      loop:
        - WLS_AUTOLOGOFF
        - WLS_TAGSAR
        - WLS_HOTPAGE

    - include_tasks:
        file: create-additional-form-servers.yml
        apply:
          tags:
            - ec2provision2
            - weblogic_create_additional_form_servers
      tags:
        - ec2provision2
        - weblogic_create_additional_form_servers
      loop_control:
        loop_var: weblogic_form_server_config
      loop: "{{ weblogic_additional_form_servers }}"

    - import_tasks: install-healthcheck.yml
      tags:
        - ec2provisionx
        - weblogic_install_healthcheck


    - import_tasks: patch-weblogic.yml
      vars:
        weblogic_patch_filename: /u01/app/oracle/Middleware/utils/bsu/cache_dir/p32832785_1036_Generic.zip
        weblogic_patch_id: 3NVW
      tags:
        - amibuild
        - weblogic_patch_1

    - import_tasks: patch-weblogic.yml
      vars:
        weblogic_patch_filename: /u01/app/oracle/Middleware/utils/bsu/cache_dir/p13964737_10360210720_Generic.zip
        weblogic_patch_id: UEYM
      tags:
        - amibuild
        - weblogic_patch_2
    
    - import_tasks: certificate-fix.yml
      tags:
        - ec2provisionx
        - weblogic_certificate_fix

  when: ansible_distribution == 'RedHat' and ansible_distribution_major_version == "6"
