---
- name: Create a ext4 filesystem on attached disk
  community.general.filesystem:
    fstype: ext4
    dev: "{{ weblogic_u01_device_name }}"

- name: Get UUID of attached disk
  ansible.builtin.command: |
    blkid -s UUID -o value {{ weblogic_u01_device_name }}
  register: blkid
  changed_when: false
  failed_when: blkid.stdout|length == 0

- name: Create /u01
  ansible.builtin.file:
    path: "/u01"
    state: directory
    owner: oracle
    group: oinstall

- name: Mount attached disk
  ansible.posix.mount:
    path: /u01
    src: "UUID={{ blkid.stdout }}"
    fstype: ext4
    state: mounted
  when: not ansible_check_mode

# Since the previous mount step may reset ownership to root
- name: Set /u01 owner as oracle
  ansible.builtin.file:
    path: /u01
    state: directory
    owner: oracle
    group: oinstall
