---
- name: Fail if get-ec2-facts roles has not been run
  fail:
    msg: "Please run get-ec2-facts role to collect tags"
  when: ec2 is not defined

- name: Check required tags
  set_fact:
    weblogic_tags: true
  when:
  - ec2.tags["Name"] is defined
  - ec2.tags["oracle-sid"] is defined
  - ec2.tags["oracle-db-hostname"] is defined
  - ec2.tags["ssm-parameters-prefix"] is defined

- name: Fail if required tags not found
  fail:
    msg: "Error, please check all required tags are defined"
  when: weblogic_tags is not defined

- name: Set SSM parameters path fact
  set_fact:
    ssm_parameters_path: '/{{ ec2.tags["ssm-parameters-prefix"] }}{{ ec2.tags["Name"] }}'

- name: Copy installation scripts
  ansible.builtin.template:
    owner: oracle
    group: oinstall
    mode: 0755
    src: "10.3/{{ item }}.j2"
    dest: "/u01/software/weblogic/{{ item }}"
  loop:
    - weblogic-setup.sh
    - weblogic-init.sh

- name: Run installation script which takes approx 30 mins
  shell: |
    cd /u01/software/weblogic/
    # ./weblogic-init.sh
