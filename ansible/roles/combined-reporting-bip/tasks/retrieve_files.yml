---
- name: Create directory to unpack BIP files
  file:
    path: "{{ sap_unpack_base_directory }}"
    state: directory
    mode: 0755

- name: Get list of BIP files from S3
  aws_s3:
    mode: list
    bucket: "{{ bip_bucket_name }}"
    prefix: "BIP/"
    marker: "BIP/"
  register: s3_bucket_items

- name: Download files from S3
  aws_s3:
    mode: get
    bucket: "{{ bip_bucket_name }}"
    object: "{{ item }}"
    dest: "{{ sap_unpack_base_directory }}/{{ item|basename }}"
  with_items: "{{ s3_bucket_items.s3_keys }}"
