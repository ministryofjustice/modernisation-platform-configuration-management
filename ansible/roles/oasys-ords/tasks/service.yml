---
- name: add startup and shutdown scripts
  template:
    src: "{{ item }}.j2"
    dest: "/usr/local/bin/{{ item }}"
    owner: "{{ ords_install_user }}"
    group: "{{ ords_install_group }}"
    mode: 0755
  loop:
    - tomcat_startup_service.sh
    - tomcat_shutdown_service.sh

- name: systemd unit file for tomcat
  template:
    src: tomcat.service.j2
    dest: /etc/systemd/system/tomcat.service

- name: enable tomcat
  systemd:
    name: "tomcat"
    daemon_reload: yes
    enabled: yes

- name: enable tomcat
  systemd:
    name: "tomcat"
    state: "started"

- name: add tomcat restart
  ansible.builtin.cron:
    name: "tomcat_restart"
    minute: "{{ 60 | random(seed=ansible_default_ipv4.address) }}"
    hour: "04"
    day: "17"
    user: root
    job: "/usr/bin/systemctl restart tomcat.service"
