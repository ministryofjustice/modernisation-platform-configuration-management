---
- name: Download Nomis release {{ nomis_release.name }}
  become_user: "{{ oracle_install_user }}"
  amazon.aws.aws_s3:
    bucket: "{{ artefacts_s3_bucket_name }}"
    object: "{{ artefacts_s3_bucket_path }}/{{ nomis_release_name }}.zip"
    dest: "{{ stage }}/{{ nomis_release_name }}.zip"
    mode: get
    permission: "public-read"
    overwrite: latest

- name: Extract release {{ nomis_release.name }} into stage directory
  ansible.builtin.unarchive:
    owner: "{{ oracle_install_user }}"
    group: "{{ oracle_install_group }}"
    src: "{{ stage }}/{{ nomis_release_name }}.zip"
    dest: "{{ stage }}"
    remote_src: true
    keep_newer: true

- name: Extract release {{ nomis_release.name }} into stage directory
  ansible.builtin.unarchive:
    owner: "{{ oracle_install_user }}"
    group: "{{ oracle_install_group }}"
    src: "{{ stage }}/{{ nomis_release_name }}.tar"
    dest: "{{ stage }}"
    remote_src: true
    keep_newer: true
