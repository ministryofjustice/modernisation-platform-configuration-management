---
- name: APP - Deploy application release {{ nomis_release.name }}
  block:
    - name: APP - Deploy tag release
      ansible.builtin.shell: |
        set -eo pipefail
        main() {
          . ~/.bash_profile
          {{ stage }}/tag_release_deployment.sh {{ stage }} {{ nomis_release.name }} {{ app_db_username }} {{ app_db_password }} {{ app_db_name }}
        }
        main 2>&1 | logger -p local3.info -t ansible-nomis-release-deployment

    - name: APP - Add note of release deployment for future verification
      ansible.builtin.lineinfile:
        path: /home/oracle/tag_release_detail
        line: "{{ nomis_release.name }}"
        create: yes

  # block
  become: true
  become_user: "{{ oracle_install_user }}"