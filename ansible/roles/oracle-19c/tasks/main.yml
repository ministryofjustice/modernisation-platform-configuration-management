---
- name: setup oracle user and groups
  import_role:
    name: common
    tasks_from: oracle_user.yml
  tags:
    - oracle_19c_download
    - pre_install
    - oracle_19c_install

- name: Create new directories
  ansible.builtin.file:
    path: "{{ item }}"
    owner: "{{ oracle_install_user }}"
    group: "{{ oracle_install_group }}"
    state: directory
    recurse: yes
  loop:
    - "{{ app_dir }}"
    - "{{ grid_base }}"
    - "{{ database_base }}"
    - "{{ database_home }}"
    - "{{ grid_home }}"
    - "{{ temp }}"
    - "{{ stage }}"
    - "{{ stage}}/psu"
  tags:
    - oracle_19c_download
    - pre_install
    - oracle_19c_install

- name: download oracle software
  import_tasks: download_software.yml
  tags:
    - oracle_19c_download
    - pre_install
    - oracle_19c_install

- name: install asm, grid and database
  block:
    - import_tasks: pre_install_tasks.yml
      tags:
        - oracle_19c_install
        - pre_install

    - import_tasks: configure_asm.yml
      tags:
        - oracle_19c_install
        - configure_asm

    - import_tasks: install_grid.yml
      tags:
        - oracle_19c_install
        - install_grid

    - import_tasks: install_database.yml
      tags:
        - oracle_19c_install
        - install_database

    - import_tasks: post_install_tasks.yml
      tags:
        - oracle_19c_install
        - install_grid
        - install_database
        - post_install
