---
- name: enable selinux
  import_role:
    name: common
    tasks_from: selinux.yml
  vars:
    status: enforcing

- name: add FLASH disk group
  ansible.builtin.shell: |
    source oraenv <<< +ASM
    sqlplus -s / as sysasm <<< "create diskgroup FLASH external redundancy disk 'ORCL:FLASH01';"
  become_user: "{{ oracle_install_user }}"
  environment: "{{ grid_env }}"
  vars:
    disks: "/dev/oracleasm/disks/"

- name: save spfile location
  ansible.builtin.shell: source oraenv <<< +ASM
    asmcmd spget > {{ temp }}/spfilelocation.txt
  become_user: "{{ oracle_install_user }}"
  environment: "{{ grid_env }}"

- name: Clean up {{ stage }} directory
  ansible.builtin.file:
    path: "{{ stage }}/{{ item }}"
    state: absent
  loop:
    - "{{ grid_response_file }}"
    - "{{ grid_install_script }}"
    - "{{ grid_software }}"
    - "{{ psu_patch }}"
    - "{{ opatch }}"
    - "{{ stage }}/psu"
    - "{{ database_response_file }}"
    - "{{ database_install_script }}"
    - "{{ db_software }}"
