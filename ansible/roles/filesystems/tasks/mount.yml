---
- name: Install packages
  ansible.builtin.package:
    name: "{{ item }}"
    state: present
  loop:
    - nfs-utils
    - cifs-utils

- name: Create mount point
  ansible.builtin.file:
    path: "{{ item.dir }}"
    state: "directory"
  loop_control:
    label: "{{ item.dir }}"
  loop: "{{ filesystems_mount }}"

- name: Mount filesystem
  ansible.posix.mount:
    fstype: "{{ item.fstype }}"
    opts: "{{ item.opts | default('defaults,nofail') }}"
    path: "{{ item.dir }}"
    src: "{{ item.src }}"
    state: "{{ item.state | default('mounted') }}"
  loop_control:
    label: "{{ item.dir }}"
  loop: "{{ filesystems_mount }}"
