---
- name: check if amazon-cloudwatch-agent installed
  ansible.builtin.shell: |
    check_installed() {
      check="$(amazon-cloudwatch-agent-ctl -m ec2 -a status)"
      if [[ $check ]]
      then 
        return 0
      else 
        return 1
      fi
    }
    check_installed
  ignore_errors: true
  register: agent_installed

# Will still fail on Rhel610 images due to: ansible-core requires a minimum of Python2 version 2.7 or Python3 version 3.5. Current version: 2.6.6
- name: Install amazon-cloudwatch-agent
  ansible.builtin.yum:
    name: "{{ amazon_cloudwatch_agent_package }}"
  when: agent_installed.rc == 1 and ansible_distribution_major_version != "6"
