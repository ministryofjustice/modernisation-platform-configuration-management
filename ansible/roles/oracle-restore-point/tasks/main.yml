---
- name: Get facts for playbook execution
  ansible.builtin.import_tasks: get_facts.yml
  tags:
    - always

- name: Create restore point on databases specified by TNS
  ansible.builtin.include_tasks:
    file: create_restore_point.yml
    apply:
      tags:
        - create_restore_point
  loop_control:
    loop_var: db_name
  loop: "{{ db_tns_list.split(',') }}"
  when: db_server_file.stat.exists and db_tns_list is defined and restore_point_name is defined and action == "create"

- name: Drop restore point from databases specified by TNS
  ansible.builtin.include_tasks:
    file: drop_restore_point.yml
    apply:
      tags:
        - drop_restore_point
  loop_control:
    loop_var: db_name
  loop: "{{ db_tns_list.split(',') }}"
  when: db_server_file.stat.exists and db_tns_list is defined and restore_point_name is defined and action == "drop"
